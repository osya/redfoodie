@model redfoodie.Models.MessagePostViewModel
@{
    ViewBag.Title = "Create Message";
}
<div data-modal-content-container="1" data-modal-wrapper-class="width_300" id="message">
    <div class="messaging-wrap">
        <h2>@ViewBag.Title</h2>
        
        @using (Ajax.BeginForm("Post", "Message", new {ViewBag.ReturnUrl}, new AjaxOptions {HttpMethod = "POST", OnBegin = "$('#message').loadingIcon('attach');", OnSuccess = "postSuccess"}, new {role = "form", id = "newform" }))
        {
            @Html.AntiForgeryToken()
            <div id="alert"></div>
            <div class="messaging-top-area clearfix">
                <div class="recipients" style="position: relative;">
                    @Html.LabelFor(m => m.To, new { @class = "caption", style = "font-weight: normal;margin-bottom:0;display:inline;" })
                    @Html.ListBoxFor(m => m.To, new List<SelectListItem>(), new { id = "ispg_appbundle_messagestype_sentTo", required = "required", data_placeholder = "Select Users", style = "width: 550px; margin-left: 10px;" })
                </div>
                <div class="clearfix"></div>
                <div class="message-write">
                    @Html.LabelFor(m => m.Message, new { @class="caption", style= "font-weight: normal;margin-bottom:0;display:inline;" })
                    <div class="wmd-panel">
                        @Html.TextAreaFor(m => m.Message, new { id = "ispg_appbundle_messagestype_message", name = "ispg_appbundle_messagestype[message]", required = "required" })
                    </div>
                    <div class="compose-area clearfix">
                        <span class="sentmsg" data-send="1">
                            <button class="btn bg-red compose send-btn" type="submit" style="color: #fff"><span>Send</span></button>
                        </span>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
@Scripts.Render("~/bundles/chosen")
<script>
    function postSuccess(data) {
        $('#message').loadingIcon('detach');
        if (data.Success) {
            $('#message #alert').noty({
                text: 'Message sent',
                dismissQueue: false,
                timeout: 5000,
                template: '<div class="noty_message confirmation-message" style="margin-bottom:0;"><span class="noty_text"></span></div>'
            });
        } else {
            // display errors
            $('#message #alert').noty({
                text: data.ErrorMessage,
                dismissQueue: false,
                template: '<div class="noty_message text-danger" style="margin-bottom:0;"><span class="noty_text"></span></div>'
            });
        }
    }
</script>